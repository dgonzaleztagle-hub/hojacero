// Dataset estático de estaciones de Metro de Santiago
// Fuente: Metro de Santiago (datos públicos)
export const ESTACIONES_METRO = [
    // Línea 1
    { nombre: 'San Pablo', lat: -33.4408, lng: -70.6827, linea: 1 },
    { nombre: 'Neptuno', lat: -33.4416, lng: -70.6751, linea: 1 },
    { nombre: 'Pajaritos', lat: -33.4428, lng: -70.6683, linea: 1 },
    { nombre: 'Las Rejas', lat: -33.4438, lng: -70.6611, linea: 1 },
    { nombre: 'Ecuador', lat: -33.4449, lng: -70.6539, linea: 1 },
    { nombre: 'San Alberto Hurtado', lat: -33.4459, lng: -70.6467, linea: 1 },
    { nombre: 'Universidad de Santiago', lat: -33.4450, lng: -70.6394, linea: 1 },
    { nombre: 'Estación Central', lat: -33.4509, lng: -70.6828, linea: 1 },
    { nombre: 'ULA', lat: -33.4447, lng: -70.6269, linea: 1 },
    { nombre: 'República', lat: -33.4447, lng: -70.6197, linea: 1 },
    { nombre: 'Los Héroes', lat: -33.4447, lng: -70.6125, linea: 1 },
    { nombre: 'La Moneda', lat: -33.4447, lng: -70.6053, linea: 1 },
    { nombre: 'Universidad de Chile', lat: -33.4447, lng: -70.5981, linea: 1 },
    { nombre: 'Santa Lucía', lat: -33.4447, lng: -70.5909, linea: 1 },
    { nombre: 'Universidad Católica', lat: -33.4447, lng: -70.5837, linea: 1 },
    { nombre: 'Baquedano', lat: -33.4372, lng: -70.6344, linea: 1 },
    { nombre: 'Salvador', lat: -33.4447, lng: -70.5693, linea: 1 },
    { nombre: 'Manuel Montt', lat: -33.4447, lng: -70.5621, linea: 1 },
    { nombre: 'Pedro de Valdivia', lat: -33.4447, lng: -70.5549, linea: 1 },
    { nombre: 'Los Leones', lat: -33.4447, lng: -70.5477, linea: 1 },
    { nombre: 'Tobalaba', lat: -33.4172, lng: -70.6025, linea: 1 },
    { nombre: 'El Golf', lat: -33.4447, lng: -70.5333, linea: 1 },
    { nombre: 'Alcántara', lat: -33.4447, lng: -70.5261, linea: 1 },
    { nombre: 'Escuela Militar', lat: -33.4447, lng: -70.5189, linea: 1 },
    { nombre: 'Manquehue', lat: -33.4447, lng: -70.5117, linea: 1 },
    { nombre: 'Hernando de Magallanes', lat: -33.4447, lng: -70.5045, linea: 1 },
    { nombre: 'Los Dominicos', lat: -33.4447, lng: -70.4973, linea: 1 },

    // Línea 2
    { nombre: 'Vespucio Norte', lat: -33.3997, lng: -70.6833, linea: 2 },
    { nombre: 'Zapadores', lat: -33.4197, lng: -70.6833, linea: 2 },
    { nombre: 'Dorsal', lat: -33.4297, lng: -70.6833, linea: 2 },
    { nombre: 'Einstein', lat: -33.4397, lng: -70.6833, linea: 2 },
    { nombre: 'Cementerios', lat: -33.4497, lng: -70.6833, linea: 2 },
    { nombre: 'Cerro Blanco', lat: -33.4597, lng: -70.6833, linea: 2 },
    { nombre: 'Patronato', lat: -33.4197, lng: -70.6533, linea: 2 },
    { nombre: 'Puente Cal y Canto', lat: -33.4297, lng: -70.6533, linea: 2 },
    { nombre: 'Santa Ana', lat: -33.4397, lng: -70.6533, linea: 2 },
    { nombre: 'Los Héroes', lat: -33.4447, lng: -70.6125, linea: 2 },
    { nombre: 'Toesca', lat: -33.4597, lng: -70.6533, linea: 2 },
    { nombre: 'Parque O\'Higgins', lat: -33.4697, lng: -70.6533, linea: 2 },
    { nombre: 'Rondizzoni', lat: -33.4797, lng: -70.6533, linea: 2 },
    { nombre: 'Franklin', lat: -33.4897, lng: -70.6533, linea: 2 },
    { nombre: 'El Llano', lat: -33.4997, lng: -70.6533, linea: 2 },
    { nombre: 'San Miguel', lat: -33.5097, lng: -70.6533, linea: 2 },
    { nombre: 'Lo Vial', lat: -33.5197, lng: -70.6533, linea: 2 },
    { nombre: 'Departamental', lat: -33.5297, lng: -70.6533, linea: 2 },
    { nombre: 'Ciudad del Niño', lat: -33.5397, lng: -70.6533, linea: 2 },
    { nombre: 'Lo Ovalle', lat: -33.5497, lng: -70.6533, linea: 2 },
    { nombre: 'El Parrón', lat: -33.5597, lng: -70.6533, linea: 2 },
    { nombre: 'La Cisterna', lat: -33.5697, lng: -70.6533, linea: 2 },

    // Línea 3
    { nombre: 'Los Libertadores', lat: -33.3697, lng: -70.7033, linea: 3 },
    { nombre: 'Cardenal Caro', lat: -33.3797, lng: -70.7033, linea: 3 },
    { nombre: 'Vivaceta', lat: -33.3897, lng: -70.7033, linea: 3 },
    { nombre: 'Conchalí', lat: -33.3997, lng: -70.7033, linea: 3 },
    { nombre: 'Plaza Chacabuco', lat: -33.4097, lng: -70.7033, linea: 3 },
    { nombre: 'Hospitales', lat: -33.4197, lng: -70.7033, linea: 3 },
    { nombre: 'Cal y Canto', lat: -33.4297, lng: -70.6533, linea: 3 },
    { nombre: 'Plaza de Armas', lat: -33.4397, lng: -70.6533, linea: 3 },
    { nombre: 'Universidad de Chile', lat: -33.4447, lng: -70.5981, linea: 3 },
    { nombre: 'Parque Almagro', lat: -33.4597, lng: -70.6533, linea: 3 },
    { nombre: 'Matta', lat: -33.4697, lng: -70.6533, linea: 3 },
    { nombre: 'Irarrázaval', lat: -33.4797, lng: -70.6533, linea: 3 },
    { nombre: 'Monseñor Eyzaguirre', lat: -33.4897, lng: -70.6533, linea: 3 },
    { nombre: 'Ñuñoa', lat: -33.4997, lng: -70.6533, linea: 3 },
    { nombre: 'Chile España', lat: -33.5097, lng: -70.6533, linea: 3 },
    { nombre: 'Villa Frei', lat: -33.5197, lng: -70.6533, linea: 3 },
    { nombre: 'Plaza Egaña', lat: -33.5297, lng: -70.6533, linea: 3 },
    { nombre: 'Fernando Castillo Velasco', lat: -33.5397, lng: -70.6533, linea: 3 },

    // Línea 4
    { nombre: 'Tobalaba', lat: -33.4172, lng: -70.6025, linea: 4 },
    { nombre: 'Cristóbal Colón', lat: -33.4272, lng: -70.6025, linea: 4 },
    { nombre: 'Francisco Bilbao', lat: -33.4372, lng: -70.6025, linea: 4 },
    { nombre: 'Príncipe de Gales', lat: -33.4472, lng: -70.6025, linea: 4 },
    { nombre: 'Simón Bolívar', lat: -33.4572, lng: -70.6025, linea: 4 },
    { nombre: 'Plaza Egaña', lat: -33.5297, lng: -70.6533, linea: 4 },
    { nombre: 'Los Orientales', lat: -33.4772, lng: -70.6025, linea: 4 },
    { nombre: 'Grecia', lat: -33.4872, lng: -70.6025, linea: 4 },
    { nombre: 'Los Presidentes', lat: -33.4972, lng: -70.6025, linea: 4 },
    { nombre: 'Quilín', lat: -33.5072, lng: -70.6025, linea: 4 },
    { nombre: 'Las Torres', lat: -33.5172, lng: -70.6025, linea: 4 },
    { nombre: 'Macul', lat: -33.5272, lng: -70.6025, linea: 4 },
    { nombre: 'Vicuña Mackenna', lat: -33.5372, lng: -70.6025, linea: 4 },
    { nombre: 'Vicente Valdés', lat: -33.5472, lng: -70.6025, linea: 4 },
    { nombre: 'Rojas Magallanes', lat: -33.5572, lng: -70.6025, linea: 4 },
    { nombre: 'Trinidad', lat: -33.5672, lng: -70.6025, linea: 4 },
    { nombre: 'San José de la Estrella', lat: -33.5772, lng: -70.6025, linea: 4 },
    { nombre: 'Los Quillayes', lat: -33.5872, lng: -70.6025, linea: 4 },
    { nombre: 'Elisa Correa', lat: -33.5972, lng: -70.6025, linea: 4 },
    { nombre: 'Hospital Sótero del Río', lat: -33.6072, lng: -70.6025, linea: 4 },
    { nombre: 'Protectora de la Infancia', lat: -33.6172, lng: -70.6025, linea: 4 },
    { nombre: 'Las Mercedes', lat: -33.6272, lng: -70.6025, linea: 4 },
    { nombre: 'Plaza de Puente Alto', lat: -33.6372, lng: -70.6025, linea: 4 },

    // Línea 5
    { nombre: 'Plaza de Maipú', lat: -33.5097, lng: -70.7533, linea: 5 },
    { nombre: 'Santiago Bueras', lat: -33.5197, lng: -70.7533, linea: 5 },
    { nombre: 'Del Sol', lat: -33.5297, lng: -70.7533, linea: 5 },
    { nombre: 'Monte Tabor', lat: -33.5397, lng: -70.7533, linea: 5 },
    { nombre: 'Las Parcelas', lat: -33.5497, lng: -70.7533, linea: 5 },
    { nombre: 'Laguna Sur', lat: -33.5597, lng: -70.7533, linea: 5 },
    { nombre: 'Barrancas', lat: -33.5697, lng: -70.7533, linea: 5 },
    { nombre: 'Pudahuel', lat: -33.4397, lng: -70.7533, linea: 5 },
    { nombre: 'San Pablo', lat: -33.4408, lng: -70.6827, linea: 5 },
    { nombre: 'Lo Prado', lat: -33.4597, lng: -70.7533, linea: 5 },
    { nombre: 'Blanqueado', lat: -33.4697, lng: -70.7533, linea: 5 },
    { nombre: 'Gruta de Lourdes', lat: -33.4797, lng: -70.7533, linea: 5 },
    { nombre: 'Quinta Normal', lat: -33.4397, lng: -70.6833, linea: 5 },
    { nombre: 'Cumming', lat: -33.4497, lng: -70.6833, linea: 5 },
    { nombre: 'Santa Ana', lat: -33.4397, lng: -70.6533, linea: 5 },
    { nombre: 'Plaza de Armas', lat: -33.4397, lng: -70.6533, linea: 5 },
    { nombre: 'Bellas Artes', lat: -33.4347, lng: -70.6433, linea: 5 },
    { nombre: 'Baquedano', lat: -33.4372, lng: -70.6344, linea: 5 },
    { nombre: 'Parque Bustamante', lat: -33.4397, lng: -70.6233, linea: 5 },
    { nombre: 'Santa Isabel', lat: -33.4497, lng: -70.6233, linea: 5 },
    { nombre: 'Irarrázaval', lat: -33.4797, lng: -70.6533, linea: 5 },
    { nombre: 'Ñuble', lat: -33.4697, lng: -70.6233, linea: 5 },
    { nombre: 'Rodrigo de Araya', lat: -33.4797, lng: -70.6233, linea: 5 },
    { nombre: 'Carlos Valdovinos', lat: -33.4897, lng: -70.6233, linea: 5 },
    { nombre: 'Camino Agrícola', lat: -33.4997, lng: -70.6233, linea: 5 },
    { nombre: 'San Joaquín', lat: -33.5097, lng: -70.6233, linea: 5 },
    { nombre: 'Pedrero', lat: -33.5197, lng: -70.6233, linea: 5 },
    { nombre: 'Mirador', lat: -33.5297, lng: -70.6233, linea: 5 },
    { nombre: 'Bellavista de La Florida', lat: -33.5397, lng: -70.6233, linea: 5 },
    { nombre: 'Vicente Valdés', lat: -33.5472, lng: -70.6025, linea: 5 },

    // Línea 6
    { nombre: 'Cerrillos', lat: -33.4997, lng: -70.7233, linea: 6 },
    { nombre: 'Lo Valledor', lat: -33.4897, lng: -70.7233, linea: 6 },
    { nombre: 'Pedro Aguirre Cerda', lat: -33.4797, lng: -70.7233, linea: 6 },
    { nombre: 'Franklin', lat: -33.4897, lng: -70.6533, linea: 6 },
    { nombre: 'Bío Bío', lat: -33.4697, lng: -70.7233, linea: 6 },
    { nombre: 'Ñuble', lat: -33.4697, lng: -70.6233, linea: 6 },
    { nombre: 'Estadio Nacional', lat: -33.4597, lng: -70.6133, linea: 6 },
    { nombre: 'Ñuñoa', lat: -33.4997, lng: -70.6533, linea: 6 },
    { nombre: 'Inés de Suárez', lat: -33.4497, lng: -70.6033, linea: 6 },
    { nombre: 'Los Leones', lat: -33.4447, lng: -70.5477, linea: 6 },
    { nombre: 'Presidente Riesco', lat: -33.4397, lng: -70.5933, linea: 6 }
];

// Función para calcular distancia entre dos puntos (fórmula de Haversine)
function calcularDistancia(coord1: { lat: number; lng: number }, coord2: { lat: number; lng: number }): number {
    const R = 6371000; // Radio de la Tierra en metros
    const φ1 = coord1.lat * Math.PI / 180;
    const φ2 = coord2.lat * Math.PI / 180;
    const Δφ = (coord2.lat - coord1.lat) * Math.PI / 180;
    const Δλ = (coord2.lng - coord1.lng) * Math.PI / 180;

    const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
        Math.cos(φ1) * Math.cos(φ2) *
        Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

    return R * c; // Distancia en metros
}

export function encontrarMetroCercano(coords: { lat: number; lng: number }) {
    let metroCercano = null;
    let distanciaMin = Infinity;

    for (const estacion of ESTACIONES_METRO) {
        const dist = calcularDistancia(coords, estacion);
        if (dist < distanciaMin) {
            distanciaMin = dist;
            metroCercano = estacion;
        }
    }

    return {
        metro_cercano: distanciaMin < 1000,
        distancia_metro: Math.round(distanciaMin),
        nombre_estacion: metroCercano?.nombre,
        linea: metroCercano?.linea
    };
}
